# PKM System - 用户手册 (User Guide)

## 目录 (Table of Contents)

1. [快速开始](#快速开始)
2. [界面导航](#界面导航)
3. [队伍管理](#队伍管理)
4. [PC 存储系统](#pc-存储系统)
5. [关系网络](#关系网络)
6. [交通系统](#交通系统)
7. [地图系统](#地图系统)
8. [系统设置](#系统设置)
9. [常见问题](#常见问题)

---

## 快速开始

### 启动方式

#### 方式一：SillyTavern 集成（推荐）
1. 在 SillyTavern 中加载 PKM 角色卡
2. 点击右上角的**金色悬浮球**（精灵球图标）
3. 系统自动加载并同步 ERA 数据

#### 方式二：直接访问
访问 GitHub Pages：`https://hasheeper.github.io/pkm55/`

### 首次使用
系统会自动从 ERA 变量读取数据，包括：
- ✅ 玩家名称
- ✅ 当前位置
- ✅ 队伍宝可梦
- ✅ PC 盒子
- ✅ NPC 好感度
- ✅ 解锁的机制

---

## 界面导航

### 主界面布局

```
┌─────────────────────────────┐
│  [信号] [返回]    时间  [电量] │ ← 状态栏
├─────────────────────────────┤
│                             │
│       主内容区域              │
│                             │
│   (Dashboard/Party/Box/     │
│    Social/Settings)         │
│                             │
└─────────────────────────────┘
```

### 状态栏说明

#### 左侧
- **信号强度**: R-NET 信号格数（1-4 格）
  - 4 格：Z 区或 PC 终端范围内
  - 1 格：无信号覆盖
- **返回按钮**: 从子页面返回主页

#### 中央
- **游戏时间**: 显示当前游戏日期和时段
  - 格式：`DAY{天数}-{时段}`
  - 时段：Dawn/Morning/Noon/Afternoon/Evening/Night/Midnight

#### 右侧
- **电量显示**: 装饰性元素

### 主页 (Dashboard)

主页显示 9 个应用磁贴：

1. **PARTY** - 队伍管理
2. **BOX** - PC 存储
3. **SOCIAL** - 关系网络
4. **TRANSIT** - 交通系统
5. **MAP** - 地图导航
6. **SETTINGS** - 系统设置
7. **其他功能**（开发中）

#### 主页信息面板
- **玩家名称**
- **当前区域**: ZONE-Z/N/B/S/A
- **队伍状态**: 显示 6 个槽位的精灵图标
- **机制能量条**: 显示已解锁的 8 种机制
  - Mega Evolution
  - Z-Move
  - Dynamax
  - Terastal
  - Sync Bond
  - Hisui Style
  - Insight
  - Limit Break

---

## 队伍管理

### 查看队伍

点击主页的 **PARTY** 磁贴进入队伍页面。

#### 队伍卡片信息

**基础信息**（始终可见）：
- 槽位编号（01-06）
- 宝可梦精灵图
- 名称/昵称
- 等级
- 性别（♂/♀/∅）
- 闪光标记（✨）
- LEAD 标记（队长）

**详细信息**（点击卡片展开）：
- **属性标签**: 双属性显示
- **性格**: 影响数值成长
- **特性**: 战斗特性
- **携带道具**: 显示道具图标
- **招式**: 4 个招式槽位
- **个体值 (IVs)**: H/A/B/C/D/S 六维数值（0-31）
- **努力值 (EVs)**: 总努力值等级

### 交互操作

#### 1. 设置队长
- 点击卡片右侧的**旗帜按钮**
- 当前队长显示为激活状态（红色）
- 队长会在卡片上显示 **LEAD** 标签

#### 2. 查看 AVS 情感值
- 点击卡片右侧的**爱心按钮**
- 显示 4 维情感面板：
  - **TRUST** (信赖)
  - **PASSION** (热情)
  - **INSIGHT** (洞察)
  - **DEVOTION** (奉献)
- 数值范围：0-255
- 达到 255 时显示为金色

#### 3. 展开/收起详情
- 点击卡片主体区域
- 点击右侧的**下箭头**按钮
- 展开后显示完整的宝可梦数据

### 空槽位
空槽位显示为虚线边框，文字为 "SLOT XX OPEN"。

---

## PC 存储系统

### 进入 PC 系统

点击主页的 **BOX** 磁贴进入 PC 存储页面。

### 信号覆盖检测

**重要**: PC 系统需要信号覆盖才能使用！

#### 信号覆盖规则
✅ **Z 区（中枢区）**: 全区域覆盖，随时可用
✅ **其他区域**: 需在 **PC_Terminal 信号塔** 3 格范围内（1.2 km）

#### 信号丢失时
如果不在信号范围内，会显示：
- 🚫 **SIGNAL LOST** 覆盖层
- 错误代码：`0x0000_OUT_OF_RANGE`
- 当前位置坐标
- 最近信号塔位置和距离
- 终端扫描日志

**解决方法**: 移动到 Z 区或靠近 PC_Terminal 信号塔。

### 界面布局

```
┌─────────────────────────────┐
│ CURRENT PARTY (HAND)        │
├─────────────────────────────┤
│ [宝可梦1] [宝可梦2] [宝可梦3] │
│ [宝可梦4] [宝可梦5] [宝可梦6] │
├─────────────────────────────┤
│ CLOUD STORAGE (SERVER)      │
├─────────────────────────────┤
│ [格子1] [格子2] ... [格子N]  │
│ [格子...] [空] [空] [空]     │
└─────────────────────────────┘
```

### 操作流程

#### 批量存入（队伍 → 盒子）

1. **选择队伍槽位**
   - 点击要存入的宝可梦（可多选）
   - 选中的卡片会高亮显示

2. **选择空白格子**
   - 点击盒子中的空白格子（可多选）
   - 数量必须与选中的队伍槽位相同

3. **执行操作**
   - 底部操作栏显示：`CMD: BATCH STORE [N] 宝可梦名称 » SERVER`
   - 点击 **EXECUTE** 按钮
   - 系统自动生成指令并复制到剪贴板

4. **发送给 AI**
   - 粘贴到 SillyTavern 对话框
   - 发送给 AI
   - AI 会执行 VariableEdit 指令并演绎传输场景

#### 批量取出（盒子 → 队伍）

1. **选择空队伍槽位**
   - 点击空槽位（可多选）

2. **选择盒子宝可梦**
   - 点击要取出的宝可梦（可多选）
   - 数量必须与空槽位相同

3. **执行操作**
   - 操作栏显示：`CMD: BATCH RETRIEVE [N] SERVER » 宝可梦名称`
   - 点击 **EXECUTE**

4. **发送给 AI**
   - 粘贴并发送指令

#### 批量交换（队伍 ↔ 盒子）

1. **选择有宝可梦的队伍槽位**
   - 点击要交换的槽位（可多选）

2. **选择盒子宝可梦**
   - 点击要交换的宝可梦（可多选）
   - 数量必须相同

3. **执行操作**
   - 操作栏显示：`CMD: BATCH SWAP [N] 队伍名称 ⇄ 盒子名称`
   - 点击 **EXECUTE**

4. **发送给 AI**
   - 粘贴并发送指令

### 操作栏说明

底部操作栏实时显示当前操作状态：

- **STATUS**: 等待选择
- **CMD**: 可执行的操作
- **ERR**: 错误提示（数量不匹配等）

#### 按钮
- **RESET**: 取消所有选择
- **EXECUTE**: 生成并复制指令

### 注意事项

⚠️ **数量必须匹配**
- 存入：队伍数量 = 空格子数量
- 取出：空槽位数量 = 盒子数量
- 交换：队伍数量 = 盒子数量

⚠️ **信号覆盖**
- 必须在信号范围内才能操作

⚠️ **数据保留**
- 宝可梦的 AVS 情感值、招式、道具等数据会完整保留

---

## 关系网络

### 进入关系网络

点击主页的 **SOCIAL** 磁贴进入关系网络页面。

### NPC 卡片

#### 显示信息
- **NPC 立绘**: Pokemon Showdown 训练师图
- **名称**: NPC 名称
- **好感度等级**: HOSTILE/COLD/NEUTRAL/FRIENDLY/TRUSTED/CALIB.3/DEVOTED
- **好感度数值**: 0-255
- **进度条**: 可视化好感度进度
- **羁绊徽章**: 特定 NPC 的解锁标记

#### 好感度等级

| 等级 | 标签 | 图标 | 数值范围 | 描述 |
|------|------|------|----------|------|
| -2 | HOSTILE | ☠️ | - | 敌对 |
| -1 | COLD | ❄️ | - | 冷淡 |
| 0 | NEUTRAL | ⚪ | 0 | 陌生人 |
| 1 | FRIENDLY | 🔹 | 1-63 | 熟人 |
| 2 | TRUSTED | 🍀 | 64-127 | 朋友 |
| 3 | CALIB.3 | 💗 | 128-191 | 亲密 |
| 4 | DEVOTED | 💍 | 192-255 | 最高羁绊 |

### 羁绊解锁系统

特定 NPC 达到最高好感度时，会解锁特殊机制：

| NPC | 解锁机制 | 徽章图标 |
|-----|----------|----------|
| Gloria | DYNAMAX BOND | 力量腕带 |
| Rosa | LINK BOND | 安抚之铃 |
| Dawn | INSIGHT LENS | 焦点镜 |
| Akari | HISUI ARTS | 讲究围巾 |
| Serena | MEGA EVO | 超级手环 |
| Selene | Z POWER | Z 手环 |
| Juliana | TERASTAL | 一般宝石 |
| May | LIMIT BREAK | 学习装置 |

#### 羁绊徽章状态
- **已解锁**: 彩色徽章，带光效
- **未解锁**: 灰色徽章，半透明

### 未解锁 NPC

好感度为 0 的 NPC 显示为：
- 灰度滤镜立绘
- 名称正常显示
- 好感度显示为 "?"
- 等级显示为 "UNKNOWN"

### 排序规则

NPC 按以下优先级排序：
1. **好感度等级**（从高到低）
2. **好感度数值**（从高到低）

---

## 交通系统

### 进入交通系统

点击主页的 **TRANSIT** 磁贴进入交通页面。

### 三大交通网络

#### 1. LOOP-LINE (环线列车)
- **图标**: 列车图标
- **特点**: 连接各区域主要城市
- **站点**: Transit_Station

#### 2. AIR-NET (空运网络)
- **图标**: 飞机图标
- **特点**: 快速跨区域运输
- **站点**: Sky_Net 停机坪

#### 3. SEAPORT (海运港口)
- **图标**: 船锚图标
- **特点**: 沿海区域连接
- **站点**: Sea_Route 码头

### 界面布局

顶部显示 3 个 Tab，点击切换交通网络。

### 站点列表

站点分为两组显示：

#### LOCAL (本地区域)
- 当前区域的所有站点
- 按距离从近到远排序
- 可以步行前往

#### EXTERNAL ZONES (外部区域)
- 其他区域的站点
- 必须在站点才能搭乘

### 站点卡片信息

- **站点名称**: 如 "Summit Dojo Point"
- **区域标签**: Zone-Z/N/B/S/A（带区域颜色）
- **坐标**: [x, y]
- **状态标记**:
  - **HERE**: 当前位置（金色标记）
  - **距离**: X.X KM（蓝色标记）
  - **锁定**: 锁图标（灰色，需先到站点）

### 使用流程

#### 同区域移动（步行）

1. 点击本地区域的站点
2. 系统生成步行指令
3. 指令自动复制到剪贴板
4. 粘贴到 AI 对话框发送

**生成的指令格式**:
```
【前往站点】
从: 当前位置 [x1, y1]
至: 站点名称 [x2, y2]
方式: 步行
区域: 区域名称

玩家步行前往站点。

<VariableEdit>
{
  "world_state": {
    "location": { "x": x2, "y": y2, "region": "区域" }
  }
}
</VariableEdit>
```

#### 跨区域移动（搭乘交通工具）

1. **前提**: 必须已经在某个站点上
2. 点击其他区域的站点
3. 系统生成交通移动指令
4. 指令自动复制到剪贴板
5. 粘贴到 AI 对话框发送

**生成的指令格式**:
```
【交通移动】
从: 起点站 [x1, y1]
至: 终点站 [x2, y2]
方式: 环线列车/空运飞行/港口航线
区域: 起始区 → 目标区

玩家搭乘交通工具从起点前往终点。

<VariableEdit>
{
  "world_state": {
    "location": { "x": x2, "y": y2, "region": "目标区" }
  }
}
</VariableEdit>
```

### 距离计算

- **单位**: 公里 (KM)
- **计算方式**: 曼哈顿距离 × 0.4
- **显示**: 
  - ≥10 km: 整数显示
  - <10 km: 一位小数显示

### 注意事项

⚠️ **跨区域限制**
- 必须在站点才能搭乘交通工具
- 不在站点时，外部区域站点显示为锁定状态

⚠️ **复制提示**
- 点击站点后，会显示通知："ROUTE COPIED - 交通方式 → 站点名称"

---

## 地图系统

### 进入地图

点击主页的 **MAP** 磁贴打开地图模态窗口。

### 地图视图

#### 全局视图（默认）
- 显示完整的 52×52 格子地图
- 玩家位置用红色标记
- 可以拖拽平移
- 可以缩放（滚轮）

#### 战术视图
- 点击右上角的 **TACTICAL** 按钮切换
- 显示玩家周围 5 格范围
- 详细的格子信息
- 实体图标显示

### 地图图层

可以通过右侧的图层开关控制显示：

- **Surface**: 地表类型
- **Traversability**: 可通行性
- **Threat**: 威胁等级
- **Regions**: 区域划分
- **Biome_Zone**: 生态区域
- **Region_Zone**: 地标区域
- **实体层**: NPC、服务设施等

### 坐标系统

#### 显示坐标
- **格式**: [x, y] 区域
- **原点**: [1, 1] 或 [-1, -1]（跳过 0）
- **X 轴**: 东正（+）西负（-）
- **Y 轴**: 北正（+）南负（-）

#### 区域划分
- **Z 区**: 中心 6×6 范围
- **N 区**: 东南象限（x>0, y<0）
- **B 区**: 西南象限（x<0, y<0）
- **S 区**: 东北象限（x>0, y>0）
- **A 区**: 西北象限（x<0, y>0）

### 战术视图操作

#### 拖拽平移
- 按住鼠标左键拖拽
- 平移范围限制在 1.2 格

#### 悬停扫描
- 鼠标悬停在格子上
- 右侧显示详细信息：
  - 坐标
  - 地表类型
  - 威胁等级
  - 可通行性
  - 区域/生态区
  - 实体信息

#### 格子信息

**地表类型**（SVG 图标）:
- CITY: 城市/铺路
- WAVE: 水面
- PLANT/TREE/FLOWER: 植物
- SAND: 沙漠
- MTN: 山地
- SNOW: 雪地
- MAGMA: 岩浆
- 等等...

**威胁等级**:
- NULL (0): 无威胁
- PEACE (6): 和平区
- SAFE (1): 安全
- LOW (2): 低危
- MID (3): 中危 ⚠️
- HIGH (4): 高危 ⚠️
- APEX (5): 极危 ⚠️

**可通行性**:
- OPEN: 开放
- PATH: 路径
- FAST: 快速通道
- 不可通行: 显示为红色

### 实体图标

地图上会显示各种实体的图标：

- **NPC**: 人物图标
- **宝可梦中心**: 十字图标
- **商店**: 购物袋图标
- **PC 终端**: 电脑图标
- **传送点**: 传送门图标
- **警察局**: 盾牌图标
- **交通站点**: 对应交通工具图标

### 全屏模式

- 点击右上角的 **全屏按钮**
- 地图扩展到全屏
- 按 ESC 或点击关闭按钮退出

---

## 系统设置

### 进入设置

点击主页的 **SETTINGS** 磁贴进入设置页面。

### 系统模块

共 6 个可切换的系统模块：

#### 1. AVS SYSTEM
- **功能**: Affective Value System（情感值系统）
- **说明**: 显示 Trust/Passion/Insight/Devotion 四维情感值
- **颜色**: 红色

#### 2. CMD. INTERFACE
- **功能**: 战术指令接口
- **说明**: 启用实时战术指令注入
- **颜色**: 黄色

#### 3. LIMIT BREAK
- **功能**: 突破进化
- **说明**: 允许战斗中进化（生物/羁绊触发）
- **颜色**: 青色

#### 4. DYN. AUDIO
- **功能**: 动态音频
- **说明**: 叙事驱动的背景音乐适配
- **颜色**: 蓝色

#### 5. SFX FEEDBACK
- **功能**: 音效反馈
- **说明**: SillyTavern UI 音效包
- **颜色**: 紫色

#### 6. CLASH SYSTEM
- **功能**: 对抗系统
- **说明**: 启用战斗中的对抗机制
- **颜色**: 橙色

### 切换开关

每个模块都有一个切换开关：
- **关闭**: 灰色轨道
- **开启**: 彩色轨道 + 滑块移动

点击卡片任意位置即可切换。

### 设置同步

设置会自动同步到 ERA 变量，AI 可以根据设置调整行为。

---

## 常见问题

### Q1: 为什么 PC 系统显示 "SIGNAL LOST"？

**A**: PC 系统需要信号覆盖才能使用。

**解决方法**:
1. 移动到 Z 区（中枢区）
2. 或者靠近 PC_Terminal 信号塔（3 格范围内）

**查看信号塔位置**:
- 打开地图
- 查找 PC_Terminal 实体（电脑图标）

---

### Q2: 为什么交通站点显示为锁定状态？

**A**: 跨区域移动需要先到达站点。

**解决方法**:
1. 先点击本地区域的站点（步行前往）
2. 到达站点后，外部区域站点会解锁
3. 然后可以搭乘交通工具前往其他区域

---

### Q3: 如何设置队长？

**A**: 
1. 进入 PARTY 页面
2. 点击宝可梦卡片右侧的**旗帜按钮**
3. 当前队长会显示 LEAD 标签

---

### Q4: 盒子操作时提示 "数量不匹配" 怎么办？

**A**: 批量操作要求选中的数量必须相同。

**示例**:
- 存入 3 只宝可梦 → 必须选择 3 个空格子
- 取出 2 只宝可梦 → 必须选择 2 个空槽位
- 交换 4 只宝可梦 → 队伍和盒子各选 4 只

---

### Q5: 为什么有些 NPC 显示为灰色？

**A**: 好感度为 0 的 NPC 显示为未解锁状态。

**解锁方法**:
- 在 AI 对话中与该 NPC 互动
- 提升好感度到 1 以上
- NPC 会变为彩色并显示详细信息

---

### Q6: 如何查看宝可梦的详细信息？

**A**: 
1. 进入 PARTY 页面
2. 点击宝可梦卡片（点击卡片主体或下箭头）
3. 卡片会展开显示：
   - 属性、性格、特性
   - 携带道具
   - 4 个招式
   - 个体值（IVs）
   - 努力值（EVs）

---

### Q7: AVS 情感值有什么用？

**A**: AVS 系统代表宝可梦与训练师的情感羁绊。

**四维情感**:
- **TRUST**: 信赖度
- **PASSION**: 热情度
- **INSIGHT**: 洞察力
- **DEVOTION**: 奉献度

**作用**:
- 影响战斗表现
- 触发特殊事件
- 解锁羁绊技能

---

### Q8: 地图上的颜色代表什么？

**A**: 
- **绿色**: 安全区域（威胁等级 1-2）
- **黄色**: 中危区域（威胁等级 3）
- **红色**: 高危区域（威胁等级 4-5）
- **紫色**: 极危区域（威胁等级 5）
- **灰色**: 不可通行区域

---

### Q9: 如何使用生成的指令？

**A**: 
1. 系统会自动将指令复制到剪贴板
2. 切换到 SillyTavern 对话窗口
3. 粘贴（Ctrl+V 或 Cmd+V）
4. 发送给 AI
5. AI 会执行 VariableEdit 指令并演绎场景

---

### Q10: 数据会丢失吗？

**A**: 不会。所有数据都存储在 SillyTavern 的 ERA 变量中。

**数据持久化**:
- ERA 变量自动保存
- 刷新页面后自动恢复
- 支持导出/导入

---

## 快捷键

目前系统主要通过鼠标操作，暂无快捷键支持。

---

## 技术支持

如遇到问题，请检查：

1. **浏览器兼容性**: 使用 Chrome/Edge/Firefox 最新版本
2. **SillyTavern 版本**: 确保使用支持 ERA 的版本
3. **网络连接**: 确保可以访问 GitHub Pages
4. **控制台日志**: 按 F12 查看浏览器控制台的错误信息

---

## 更新日志

### Version Dawn (当前版本)
- ✅ 完整的队伍管理系统
- ✅ PC 存储系统（信号塔机制）
- ✅ 关系网络系统
- ✅ 交通系统（三大网络）
- ✅ 地图系统（全局+战术视图）
- ✅ AVS 情感系统
- ✅ 羁绊解锁系统
- ✅ 异变事件系统

---

## 致谢

感谢所有为 PKM System 做出贡献的开发者和测试者！

**资源来源**:
- 精灵图: PokemonDB, Pokemon Showdown
- 道具图标: PokeAPI
- 训练师立绘: Pokemon Showdown
- 字体: Google Fonts

---

**享受你的训练师之旅！** 🎮✨
